import{_ as $,r as n,c as j,a as l,w as a,d as r,j as I,u as L,f as U,b as T,g as S,h as b,E as w}from"./index-DGdkDIp8.js";import{l as N,r as h}from"./auth-vkCmgdyK.js";import"./http-CBG7w8uf.js";const z={class:"container small"},D={__name:"AuthView",setup(F){const k=n("login"),m=n("account"),v=n(""),f=n(""),i=n(""),_=n(""),V=n(""),p=n(""),c=n(""),d=n(!1),y=I(),x=L();async function P(){d.value=!0;try{let t;if(m.value==="account"){if(!v.value||!i.value)throw new Error("请输入用户名和密码");t=await N({username:v.value,password:i.value})}else{if(!f.value||!i.value)throw new Error("请输入手机号和密码");t=await N({username:f.value,password:i.value})}if(t&&t.token&&t.user)if((t.user.role||"")==="admin")y.push("/admin");else{const g=x.query.redirect||"/";y.push(String(g))}else w.error("登录失败：账号/手机号或密码错误")}catch(t){w.error(String(t.message||"请求失败"))}finally{d.value=!1}}async function q(){d.value=!0;try{if(!_.value||!V.value||!p.value||!c.value)throw new Error("请完整填写注册信息");if(p.value!==c.value)throw new Error("两次输入的密码不一致");const t=await h({username:_.value,password:p.value,phone:V.value});if(t&&t.token&&t.user){const e=x.query.redirect||"/";y.push(String(e))}else w.error("注册失败或用户已存在")}catch(t){w.error(String(t.message||"请求失败"))}finally{d.value=!1}}return(t,e)=>{const g=r("el-radio"),A=r("el-radio-group"),u=r("el-form-item"),s=r("el-input"),E=r("el-button"),B=r("el-form"),C=r("el-tab-pane"),M=r("el-tabs"),R=r("el-card");return U(),j("div",z,[l(R,null,{default:a(()=>[e[13]||(e[13]=T("div",{class:"title"},"登录 / 注册",-1)),l(M,{modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=o=>k.value=o)},{default:a(()=>[l(C,{label:"登录",name:"login"},{default:a(()=>[l(B,{"label-width":"100px"},{default:a(()=>[l(u,{label:"登录方式"},{default:a(()=>[l(A,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o)},{default:a(()=>[l(g,{label:"account"},{default:a(()=>[...e[9]||(e[9]=[b("账号登录",-1)])]),_:1}),l(g,{label:"phone"},{default:a(()=>[...e[10]||(e[10]=[b("手机号登录",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),m.value==="account"?(U(),S(u,{key:0,label:"用户名"},{default:a(()=>[l(s,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=o=>v.value=o),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1})):(U(),S(u,{key:1,label:"手机号"},{default:a(()=>[l(s,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=o=>f.value=o),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})),l(u,{label:"密码"},{default:a(()=>[l(s,{modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=o=>i.value=o),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(E,{type:"primary",onClick:P,loading:d.value,disabled:d.value},{default:a(()=>[...e[11]||(e[11]=[b("登录",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1}),l(C,{label:"注册",name:"register"},{default:a(()=>[l(B,{"label-width":"100px"},{default:a(()=>[l(u,{label:"注册用户名"},{default:a(()=>[l(s,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=o=>_.value=o),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(u,{label:"注册手机号"},{default:a(()=>[l(s,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=o=>V.value=o),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(u,{label:"设置密码"},{default:a(()=>[l(s,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=o=>p.value=o),type:"password",placeholder:"请设置密码"},null,8,["modelValue"])]),_:1}),l(u,{label:"确认密码"},{default:a(()=>[l(s,{modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=o=>c.value=o),type:"password",placeholder:"请再次输入密码"},null,8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(E,{type:"primary",onClick:q,loading:d.value,disabled:d.value},{default:a(()=>[...e[12]||(e[12]=[b("注册",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}},K=$(D,[["__scopeId","data-v-4d6878cd"]]);export{K as default};
