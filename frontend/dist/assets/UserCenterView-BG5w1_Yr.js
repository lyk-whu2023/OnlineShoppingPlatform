import{g as I,u as M,c as z}from"./users-CEmQ3tWW.js";import{a as B}from"./auth-vkCmgdyK.js";import{_ as N,r as p,o as $,c as A,a as l,w as a,d,f as D,b as g,h as n,t as P,E as w}from"./index-DGdkDIp8.js";import"./http-CBG7w8uf.js";const F={class:"container"},L={class:"actions"},T={__name:"UserCenterView",setup(j){const u=p(null);$(async()=>{try{u.value=await I()}catch{u.value=null}});const i=p(!1),f=p({phone:""}),m=p(!1),t=p({oldPassword:"",newPassword:"",newPassword2:""});function b(){var s;f.value={phone:((s=u.value)==null?void 0:s.phone)||""},i.value=!0}function C(){t.value={oldPassword:"",newPassword:"",newPassword2:""},m.value=!0}async function k(){try{const s=await M({phone:f.value.phone});u.value=s,i.value=!1,w.success("已保存")}catch(s){w.error(String(s.message||"保存失败"))}}async function U(){try{if(!t.value.oldPassword||!t.value.newPassword||!t.value.newPassword2)throw new Error("请完整填写密码信息");if(t.value.newPassword!==t.value.newPassword2)throw new Error("两次输入的新密码不一致");await z({oldPassword:t.value.oldPassword,newPassword:t.value.newPassword}),m.value=!1,w.success("已重置密码")}catch(s){w.error(String(s.message||"重置失败"))}}async function x(){try{await B()}catch{}localStorage.removeItem("token"),localStorage.removeItem("userId"),localStorage.removeItem("user"),w.success("已退出登录")}return(s,e)=>{const c=d("el-descriptions-item"),E=d("el-descriptions"),r=d("el-button"),S=d("el-card"),v=d("el-input"),_=d("el-form-item"),V=d("el-form"),y=d("el-dialog");return D(),A("div",F,[l(S,null,{default:a(()=>[e[11]||(e[11]=g("div",{class:"title"},"基本信息",-1)),l(E,{column:2},{default:a(()=>[l(c,{label:"姓名"},{default:a(()=>{var o;return[n(P(((o=u.value)==null?void 0:o.username)||"未登录"),1)]}),_:1}),l(c,{label:"手机号"},{default:a(()=>{var o;return[n(P(((o=u.value)==null?void 0:o.phone)||"-"),1)]}),_:1}),l(c,{label:"注册时间"},{default:a(()=>{var o;return[n(P(((o=u.value)==null?void 0:o.createdAt)||"-"),1)]}),_:1})]),_:1}),g("div",L,[l(r,{type:"primary",size:"small",onClick:b},{default:a(()=>[...e[8]||(e[8]=[n("编辑信息",-1)])]),_:1}),l(r,{type:"primary",size:"small",onClick:C},{default:a(()=>[...e[9]||(e[9]=[n("修改密码",-1)])]),_:1}),l(r,{size:"small",onClick:x},{default:a(()=>[...e[10]||(e[10]=[n("退出登录",-1)])]),_:1})])]),_:1}),l(y,{title:"编辑信息",modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value=o)},{default:a(()=>[l(V,{"label-width":"100px"},{footer:a(()=>[l(r,{onClick:e[1]||(e[1]=o=>i.value=!1)},{default:a(()=>[...e[12]||(e[12]=[n("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:k},{default:a(()=>[...e[13]||(e[13]=[n("保存",-1)])]),_:1})]),default:a(()=>[l(_,{label:"手机号"},{default:a(()=>[l(v,{modelValue:f.value.phone,"onUpdate:modelValue":e[0]||(e[0]=o=>f.value.phone=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(y,{title:"修改密码",modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=o=>m.value=o)},{default:a(()=>[l(V,{"label-width":"100px"},{footer:a(()=>[l(r,{onClick:e[6]||(e[6]=o=>m.value=!1)},{default:a(()=>[...e[14]||(e[14]=[n("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:U},{default:a(()=>[...e[15]||(e[15]=[n("重置密码",-1)])]),_:1})]),default:a(()=>[l(_,{label:"原密码"},{default:a(()=>[l(v,{modelValue:t.value.oldPassword,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.oldPassword=o),type:"password"},null,8,["modelValue"])]),_:1}),l(_,{label:"新密码"},{default:a(()=>[l(v,{modelValue:t.value.newPassword,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.newPassword=o),type:"password"},null,8,["modelValue"])]),_:1}),l(_,{label:"确认新密码"},{default:a(()=>[l(v,{modelValue:t.value.newPassword2,"onUpdate:modelValue":e[5]||(e[5]=o=>t.value.newPassword2=o),type:"password"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},K=N(T,[["__scopeId","data-v-86fc5f80"]]);export{K as default};
