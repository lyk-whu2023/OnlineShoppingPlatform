# 后端设计 (Spring Boot)

## 1. 技术架构
- **核心框架**: Spring Boot 3.x
- **持久层**: MyBatis (配合 `mysql-connector-j`)
- **数据库**: MySQL 8.0
- **构建工具**: Maven
- **开发语言**: Java 17

## 2. 目录结构 (`src/main/java/org/example/onlineshoppingplatform`)
- **config**: 配置类
    - `WebConfig.java`: CORS 跨域配置
    - `MybatisConfig.java`: MyBatis 扫描配置
- **controller**: REST API 控制器
    - 处理 HTTP 请求，调用 Service，返回 DTO 或 Map。
    - 统一使用 `@RestController` 和 `@RequestMapping`。
- **service**: 业务逻辑层
    - `impl`: 接口实现类，包含核心业务逻辑（如下单扣库存、计算总价）。
    - 负责 Entity 与 DTO 之间的转换。
- **mapper**: 数据访问层
    - 使用 MyBatis 注解 (`@Select`, `@Insert`, `@Update`, `@Delete`) 直接定义 SQL。
    - `ProductMapper`, `OrderMapper` 等。
- **entity**: 数据库实体类
    - 对应数据库表结构 (`User`, `Product`, `Order` 等)。
- **dto**: 数据传输对象
    - 用于前后端交互的数据结构 (`UserDTO`, `ProductDTO`, `OrderDTO` 等)。
- **security**: 安全相关
    - `JwtUtil`: JWT Token 生成与解析。
    - `JwtAuthInterceptor`: 拦截请求，验证 Token，注入用户信息。

## 3. 核心设计模式
- **MVC 模式**: Controller - Service - Mapper 分层架构。
- **DTO 模式**: 使用 DTO 隔离数据库实体与前端视图模型，避免敏感字段泄露（如密码）。
- **拦截器模式**: 使用 Spring Interceptor 处理统一认证。

## 4. 数据库设计
- **users**: 用户表 (id, username, password, role, ...)
- **products**: 商品表 (id, name, price, stock, category_id, ...)
- **orders**: 订单表 (id, user_id, amount, status, ...)
- **order_items**: 订单明细表 (id, order_id, product_id, price, quantity, ...)
- **cart**: 购物车表 (id, user_id, ...)
- **cart_items**: 购物车明细 (id, cart_id, product_id, quantity, ...)
- **addresses**: 地址表 (id, user_id, name, phone, detail, ...)
