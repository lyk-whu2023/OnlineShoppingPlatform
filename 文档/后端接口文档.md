# 后端接口文档（实现版）

- 基础地址：`http://localhost:10002/api`
- 对齐前端接口提案，并给出已实现的请求/响应

## 分类

- `GET /categories`
  - 响应：`CategoryDTO[]`
- `POST /categories`
  - 请求：`CategoryDTO{ name }`
  - 响应：`CategoryDTO`
- `PUT /categories/{id}`、`DELETE /categories/{id}`

实现位置：`src/main/java/org/example/onlineshoppingplatform/controller/CategoryController.java:12`

## 商品

- `GET /products`
  - 查询参数：`ProductQueryDTO{ categoryId?, keyword?, minPrice?, maxPrice?, sort?, page?, size? }`
  - `sort` 支持：`sales`（销量优先）、`price_asc`（价格升序）、`price_desc`（价格降序）
  - 响应：`{ list: ProductDTO[], total, page, size }`
- `GET /products/{id}` → `ProductDTO`
- `GET /products/{id}/images` → `string[]`
- `POST /products`、`PUT /products/{id}`、`DELETE /products/{id}`

实现位置：`src/main/java/org/example/onlineshoppingplatform/controller/ProductController.java:15`

## 用户与认证

- `POST /auth/login`
  - 请求：`{ username, password }`
  - 响应：`{ token, user: UserDTO }`
  - 说明：`username` 可填写账号或手机号（均需搭配密码）
- `POST /auth/register`
  - 请求：`{ username, password, phone }`
  - 响应：`{ token, user: UserDTO }`
- `POST /auth/logout`
  - 响应：`204`
- `GET /users/me`
  - 响应：`UserDTO`
- `POST /users/me`
  - 请求：`{ phone }`
  - 响应：`UserDTO`
 - `POST /users/me/password`
   - 请求：`{ oldPassword, newPassword }`
   - 响应：`204`（空响应）
- 管理端：`GET /users`、`PATCH /users/{id}/status`（`{ status }`）

实现位置：`src/main/java/org/example/onlineshoppingplatform/controller/AuthController.java:13`、`src/main/java/org/example/onlineshoppingplatform/controller/UserController.java:12`

## 地址

- `GET /addresses` → `AddressDTO[]`
- `POST /addresses` → `AddressDTO`
- `PUT /addresses/{id}`、`DELETE /addresses/{id}`

实现位置：`src/main/java/org/example/onlineshoppingplatform/controller/AddressController.java:12`

## 购物车

- 需认证（`Authorization: Bearer <token>`）
- `GET /cart` → `CartItemDTO[]`
- `POST /cart/items` → `CartItemDTO[]`（新增后返回全量）
- `PUT /cart/items/{productId}`（`{ qty }`） → `CartItemDTO[]`
- `DELETE /cart/items/{productId}` → `CartItemDTO[]`
- `DELETE /cart` → `204`

实现位置：`src/main/java/org/example/onlineshoppingplatform/controller/CartController.java:12`

## 订单

- `POST /orders`（需认证，请求体 `{ addressId }`） → `OrderDTO`
- `GET /orders/{id}` → `OrderDTO`
- `GET /orders?userId=` 或 `GET /orders?status=` → `OrderDTO[]`
- `PATCH /orders/{id}/status`（`{ status }`） → `204`

实现位置：`src/main/java/org/example/onlineshoppingplatform/controller/OrderController.java:12`

## 支付

- `GET /payments/{orderId}` → `PaymentDTO`
- `PUT /payments/{orderId}`（请求体 `PaymentDTO`） → `PaymentDTO`

实现位置：`src/main/java/org/example/onlineshoppingplatform/controller/PaymentController.java:12`

## 物流

- `GET /shipments/{orderId}` → `ShipmentDTO`
- `PUT /shipments/{orderId}`（请求体 `ShipmentDTO`） → `ShipmentDTO`

实现位置：`src/main/java/org/example/onlineshoppingplatform/controller/ShipmentController.java:12`

## 错误约定与说明

- 响应错误时返回标准 HTTP 状态码；控制器返回 `null` 将映射为 `200` 的空响应，建议后续引入全局异常以统一错误码
- 认证与授权：已使用 JWT 与拦截器解析用户；用户端路由在商品详情与购物车等页面启用登录守卫，未登录访问将重定向至 `/login?redirect=...`
